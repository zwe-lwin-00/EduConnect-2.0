<div class="page-block">
  <dx-button text="← My students" type="normal" stylingMode="text" (onClick)="navigateToParent()" class="back-btn"></dx-button>
  <dx-toast [visible]="!!error" type="error" [message]="error" [displayTime]="6000" (onHidden)="error = ''" [position]="{ at: { x: 'center', y: 'top' }, my: { x: 'center', y: 'top' } }"></dx-toast>
  <dx-load-panel [visible]="loading" [showIndicator]="true" [showPane]="true" [shading]="false" message="Loading…"></dx-load-panel>
  <div *ngIf="!loading && invalidStudent" class="invalid-student">
    <p>Invalid student.</p>
    <p>This student is not linked to your account.</p>
    <dx-button text="Return to My students" type="normal" (onClick)="navigateToParent()"></dx-button>
  </div>
  <div *ngIf="!loading && !error && !invalidStudent && overview">
    <header class="header">
      <h1>{{ overview.studentName }}</h1>
      <p class="grade">Grade {{ overview.grade }}</p>
      <p *ngIf="overview.assignedTeacherName" class="teacher">Assigned teacher: {{ overview.assignedTeacherName }}</p>
      <dx-button text="View month calendar →" type="default" (onClick)="navigateToCalendar()"></dx-button>
    </header>
    <section>
      <h2>Progress</h2>
      <p>Total sessions: {{ overview.totalSessionsCount }} · Homework completed: {{ overview.completedHomeworkCount }}</p>
    </section>
    <section>
      <h2>Recent sessions</h2>
      <p *ngIf="!overview.recentSessions?.length" class="section-empty">No recent sessions.</p>
      <dx-data-grid *ngIf="overview.recentSessions?.length" [dataSource]="overview.recentSessions" [showBorders]="true">
        <dxi-column dataField="sessionDate" caption="Date" dataType="date"></dxi-column>
        <dxi-column dataField="type" caption="Type"></dxi-column>
        <dxi-column dataField="teacherOrClassName" caption="Teacher / Class"></dxi-column>
        <dxi-column dataField="checkInAt" caption="Check-in"></dxi-column>
        <dxi-column dataField="checkOutAt" caption="Check-out"></dxi-column>
        <dxi-column dataField="lessonNotes" caption="Notes"></dxi-column>
      </dx-data-grid>
    </section>
    <section>
      <h2>Homework</h2>
      <p *ngIf="!overview.homework?.length" class="section-empty">No homework.</p>
      <dx-data-grid *ngIf="overview.homework?.length" [dataSource]="overview.homework" [showBorders]="true" keyExpr="id">
        <dxi-column dataField="title" caption="Title"></dxi-column>
        <dxi-column dataField="dueDate" caption="Due" dataType="date"></dxi-column>
        <dxi-column dataField="status" caption="Status"></dxi-column>
        <dxi-column dataField="teacherFeedback" caption="Feedback"></dxi-column>
      </dx-data-grid>
    </section>
    <section>
      <h2>Grades</h2>
      <p *ngIf="!overview.grades?.length" class="section-empty">No grades yet.</p>
      <dx-data-grid *ngIf="overview.grades?.length" [dataSource]="overview.grades" [showBorders]="true" keyExpr="id">
        <dxi-column dataField="title" caption="Title"></dxi-column>
        <dxi-column dataField="gradeValue" caption="Score" dataType="number"></dxi-column>
        <dxi-column dataField="maxValue" caption="Max" dataType="number"></dxi-column>
        <dxi-column dataField="gradeDate" caption="Date" dataType="date"></dxi-column>
        <dxi-column dataField="notes" caption="Notes"></dxi-column>
      </dx-data-grid>
    </section>
  </div>
</div>
