<div class="page-block">
  <header class="page-header">
    <h1>Weekly availability</h1>
  </header>
  <p class="hint">Set your available time slots (1–7 = Mon–Sun). Save to update.</p>
  <dx-toast [visible]="!!error" type="error" [message]="error" [displayTime]="6000" (onHidden)="error = ''" [position]="{ at: { x: 'center', y: 'top' }, my: { x: 'center', y: 'top' } }"></dx-toast>
  <dx-load-panel [visible]="loading" [showIndicator]="true" [showPane]="true" [shading]="false" message="Loading…"></dx-load-panel>
  <div *ngIf="!loading && !error && !slots.length" class="empty-state">
    <p>No slots yet. Add a slot below and save.</p>
  </div>
  <div *ngIf="!loading && !error">
    <div class="slot-list">
      <div *ngFor="let s of slots; let i = index" class="slot-row">
        <dx-select-box [dataSource]="dayOptions" displayExpr="label" valueExpr="value" [(value)]="s.dayOfWeek" [width]="100"></dx-select-box>
        <dx-date-box [value]="$any(s.startTime)" (valueChange)="s.startTime = toTimeStr($event)" type="time" pickerType="rollers" [width]="120"></dx-date-box>
        <span>–</span>
        <dx-date-box [value]="$any(s.endTime)" (valueChange)="s.endTime = toTimeStr($event)" type="time" pickerType="rollers" [width]="120"></dx-date-box>
        <dx-button text="Remove" type="normal" (onClick)="removeSlot(i)"></dx-button>
      </div>
    </div>
    <div class="add-row">
      <dx-select-box [dataSource]="dayOptions" displayExpr="label" valueExpr="value" [(value)]="newSlot.dayOfWeek" [width]="100"></dx-select-box>
      <dx-date-box [value]="$any(newSlot.startTime)" (valueChange)="newSlot.startTime = toTimeStr($event)" type="time" pickerType="rollers" [width]="120"></dx-date-box>
      <dx-date-box [value]="$any(newSlot.endTime)" (valueChange)="newSlot.endTime = toTimeStr($event)" type="time" pickerType="rollers" [width]="120"></dx-date-box>
      <dx-button text="Add slot" type="default" (onClick)="addSlot()"></dx-button>
    </div>
    <dx-button [text]="saving ? 'Saving…' : 'Save availability'" type="default" (onClick)="save()" [disabled]="saving"></dx-button>
  </div>
</div>
