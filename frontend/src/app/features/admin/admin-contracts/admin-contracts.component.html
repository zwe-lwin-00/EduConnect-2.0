<div class="page-block">
  <header class="page-header">
    <h1>One-To-One (Contracts)</h1>
    <dx-button text="Create One-To-One" type="default" (onClick)="openCreate()"></dx-button>
  </header>
  <dx-toast [visible]="!!error" type="error" [message]="error" [displayTime]="6000" (onHidden)="error = ''" [position]="{ at: { x: 'center', y: 'top' }, my: { x: 'center', y: 'top' } }"></dx-toast>
  <dx-load-panel [visible]="loading" [showIndicator]="true" [showPane]="true" [shading]="false" message="Loadingâ€¦"></dx-load-panel>
  <div *ngIf="!loading && !error && !contracts.length" class="empty-state">
    <p>No One-To-One contracts yet.</p>
    <dx-button text="Create One-To-One" type="default" (onClick)="openCreate()"></dx-button>
  </div>
  <dx-data-grid *ngIf="!loading && !error && contracts.length" [dataSource]="contracts" [showBorders]="true" keyExpr="id">
    <dxi-column dataField="teacherName" caption="Teacher"></dxi-column>
    <dxi-column dataField="studentName" caption="Student"></dxi-column>
    <dxi-column dataField="status" caption="Status"></dxi-column>
    <dxi-column caption="Schedule" [calculateCellValue]="formatScheduleCell"></dxi-column>
    <dxi-column type="buttons" width="100">
      <dxi-button hint="Cancel" (onClick)="cancelContract($any($event).row.data)"></dxi-button>
    </dxi-column>
  </dx-data-grid>
</div>
<dx-popup [(visible)]="showCreate" title="Create One-To-One" [showCloseButton]="true" [width]="480" (onHiding)="closeCreate()">
  <div class="popup-form">
    <div class="form-item">
      <label>Teacher</label>
      <dx-select-box [dataSource]="teachers" displayExpr="fullName" valueExpr="id" [(value)]="form.teacherId" placeholder="--"></dx-select-box>
    </div>
    <div class="form-item">
      <label>Student</label>
      <dx-select-box [dataSource]="students" displayExpr="fullName" valueExpr="id" [(value)]="form.studentId" placeholder="--"></dx-select-box>
    </div>
    <div class="form-item">
      <label>Subscription (One-To-One) or Legacy end date</label>
      <dx-select-box [dataSource]="subscriptionOptions" displayExpr="label" valueExpr="id" [(value)]="form.subscriptionId" placeholder="Use legacy end date"></dx-select-box>
    </div>
    <div class="form-item" *ngIf="!form.subscriptionId">
      <label>Legacy period end</label>
      <dx-date-box [(value)]="form.legacyPeriodEnd" type="date"></dx-date-box>
    </div>
    <div class="form-item">
      <label>Days of week</label>
      <dx-tag-box [dataSource]="dayOptions" displayExpr="label" valueExpr="value" [(value)]="form.daysOfWeek" [multiline]="false"></dx-tag-box>
    </div>
    <div class="form-item">
      <label>Start time (optional)</label>
      <dx-date-box [(value)]="form.scheduleStartTime" type="time" pickerType="rollers"></dx-date-box>
    </div>
    <div class="form-item">
      <label>End time (optional)</label>
      <dx-date-box [(value)]="form.scheduleEndTime" type="time" pickerType="rollers"></dx-date-box>
    </div>
    <div class="popup-actions">
      <dx-button text="Create" type="default" (onClick)="submitCreate()"></dx-button>
      <dx-button text="Cancel" type="normal" (onClick)="closeCreate()"></dx-button>
    </div>
  </div>
</dx-popup>
<dx-popup [(visible)]="showConfirmCancel" title="Cancel contract" [showCloseButton]="true" [width]="400" (onHiding)="showConfirmCancel = false; contractToCancel = null">
  <p>Cancel this One-To-One contract?</p>
  <div class="popup-actions">
    <dx-button text="Yes, cancel" type="danger" (onClick)="confirmCancelContract()"></dx-button>
    <dx-button text="No" type="normal" (onClick)="showConfirmCancel = false"></dx-button>
  </div>
</dx-popup>
