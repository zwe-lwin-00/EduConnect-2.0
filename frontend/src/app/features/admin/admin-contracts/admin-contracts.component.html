<div class="page-block">
  <header class="page-header">
    <h1>One-To-One (Contracts)</h1>
    <button type="button" class="btn-primary" (click)="openCreate()">Create One-To-One</button>
  </header>
  <p *ngIf="error" class="error">{{ error }}</p>
  <div *ngIf="loading" class="loading" aria-live="polite">Loadingâ€¦</div>
  <div *ngIf="!loading && !error && !contracts.length" class="empty-state">
    <p>No One-To-One contracts yet.</p>
    <button type="button" class="btn-primary" (click)="openCreate()">Create One-To-One</button>
  </div>
  <dx-data-grid *ngIf="!loading && !error && contracts.length" [dataSource]="contracts" [showBorders]="true" keyExpr="id">
    <dxi-column dataField="teacherName" caption="Teacher"></dxi-column>
    <dxi-column dataField="studentName" caption="Student"></dxi-column>
    <dxi-column dataField="status" caption="Status"></dxi-column>
    <dxi-column caption="Schedule" [calculateCellValue]="(e) => formatSchedule(e)"></dxi-column>
    <dxi-column type="buttons" width="100">
      <dxi-button hint="Cancel" (onClick)="cancelContract($event.row.data)"></dxi-button>
    </dxi-column>
  </dx-data-grid>
</div>
<div class="modal" *ngIf="showCreate">
  <app-card class="modal-content">
    <h2>Create One-To-One</h2>
    <div class="form-group">
      <label>Teacher</label>
      <select [(ngModel)]="form.teacherId">
        <option value="">--</option>
        <option *ngFor="let t of teachers" [value]="t.id">{{ t.fullName }}</option>
      </select>
    </div>
    <div class="form-group">
      <label>Student</label>
      <select [(ngModel)]="form.studentId">
        <option value="">--</option>
        <option *ngFor="let s of students" [value]="s.id">{{ s.fullName }}</option>
      </select>
    </div>
    <div class="form-group">
      <label>Subscription (One-To-One) or Legacy end date</label>
      <select [(ngModel)]="form.subscriptionId">
        <option value="">Use legacy end date</option>
        <option *ngFor="let sub of subscriptions" [value]="sub.id">{{ sub.studentName }} until {{ sub.endDate }}</option>
      </select>
    </div>
    <div class="form-group" *ngIf="!form.subscriptionId">
      <label>Legacy period end</label>
      <input type="date" [(ngModel)]="form.legacyPeriodEnd" />
    </div>
    <div class="form-group">
      <label>Days of week</label>
      <div class="days-row">
        <label *ngFor="let opt of dayOptions" class="day-checkbox">
          <input type="checkbox" [checked]="isDayChecked(opt.value)" (change)="toggleDay(opt.value)" />
          {{ opt.label }}
        </label>
      </div>
    </div>
    <div class="form-group">
      <label>Start time (optional)</label>
      <input type="time" [(ngModel)]="form.scheduleStartTime" />
    </div>
    <div class="form-group">
      <label>End time (optional)</label>
      <input type="time" [(ngModel)]="form.scheduleEndTime" />
    </div>
    <div class="modal-actions">
      <button type="button" (click)="submitCreate()">Create</button>
      <button type="button" (click)="closeCreate()">Cancel</button>
    </div>
  </app-card>
</div>
