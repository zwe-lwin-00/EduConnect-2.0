<div class="page-block">
  <header class="page-header">
    <h1>Students</h1>
    <button type="button" class="btn-primary" (click)="openAdd()">Add student</button>
  </header>
  <p *ngIf="error" class="error">{{ error }}</p>
  <div *ngIf="loading" class="loading" aria-live="polite">Loading…</div>
  <div *ngIf="!loading && !error && !students.length" class="empty-state">
    <p>No students yet.</p>
    <button type="button" class="btn-primary" (click)="openAdd()">Add student</button>
  </div>
  <dx-data-grid *ngIf="!loading && !error && students.length" [dataSource]="students" [showBorders]="true" keyExpr="id">
    <dxi-column dataField="fullName" caption="Name"></dxi-column>
    <dxi-column dataField="grade" caption="Grade"></dxi-column>
    <dxi-column dataField="parentName" caption="Parent"></dxi-column>
    <dxi-column dataField="dateOfBirth" caption="DOB" dataType="date"></dxi-column>
    <dxi-column dataField="active" caption="Active" dataType="boolean"></dxi-column>
    <dxi-column type="buttons" width="140" caption="Actions">
      <dxi-button hint="Freeze" (onClick)="setActive($any($event).row.data, false)"></dxi-button>
      <dxi-button hint="Activate" (onClick)="setActive($any($event).row.data, true)"></dxi-button>
    </dxi-column>
  </dx-data-grid>
</div>
<div class="modal" *ngIf="showAdd">
  <app-card class="modal-content">
    <h2>Add student</h2>
    <div class="form-group">
      <label>Parent</label>
      <select [(ngModel)]="form.parentId">
        <option value="" disabled>— Select parent —</option>
        <option *ngFor="let p of parents" [value]="p.id">{{ p.fullName }} ({{ p.email }})</option>
      </select>
    </div>
    <div class="form-group">
      <label>Full name</label>
      <input type="text" [(ngModel)]="form.fullName" />
    </div>
    <div class="form-group">
      <label>Grade</label>
      <select [(ngModel)]="form.grade">
        <option value="P1">P1</option>
        <option value="P2">P2</option>
        <option value="P3">P3</option>
        <option value="P4">P4</option>
      </select>
    </div>
    <div class="form-group">
      <label>Date of birth</label>
      <input type="date" [(ngModel)]="form.dateOfBirth" />
    </div>
    <div class="modal-actions">
      <button type="button" (click)="submitAdd()">Add</button>
      <button type="button" (click)="closeAdd()">Cancel</button>
    </div>
  </app-card>
</div>
