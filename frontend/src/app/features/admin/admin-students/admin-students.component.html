<div class="page-block">
  <header class="page-header">
    <h1>Students</h1>
    <dx-button text="Add student" type="default" (onClick)="openAdd()"></dx-button>
  </header>
  <dx-toast [visible]="!!error" type="error" [message]="error" [displayTime]="6000" (onHidden)="error = ''" [position]="{ at: { x: 'center', y: 'top' }, my: { x: 'center', y: 'top' } }"></dx-toast>
  <dx-load-panel [visible]="loading" [showIndicator]="true" [showPane]="true" [shading]="false" message="Loading…"></dx-load-panel>
  <div *ngIf="!loading && !error && !students.length" class="empty-state">
    <p>No students yet.</p>
    <dx-button text="Add student" type="default" (onClick)="openAdd()"></dx-button>
  </div>
  <dx-data-grid *ngIf="!loading && !error && students.length" [dataSource]="students" [showBorders]="true" keyExpr="id">
    <dxi-column dataField="fullName" caption="Name"></dxi-column>
    <dxi-column dataField="grade" caption="Grade"></dxi-column>
    <dxi-column dataField="parentName" caption="Parent"></dxi-column>
    <dxi-column dataField="dateOfBirth" caption="DOB" dataType="date"></dxi-column>
    <dxi-column dataField="active" caption="Active" dataType="boolean"></dxi-column>
    <dxi-column type="buttons" width="140" caption="Actions">
      <dxi-button hint="Freeze" (onClick)="setActive($any($event).row.data, false)"></dxi-button>
      <dxi-button hint="Activate" (onClick)="setActive($any($event).row.data, true)"></dxi-button>
    </dxi-column>
  </dx-data-grid>
</div>
<dx-popup [(visible)]="showAdd" title="Add student" [showCloseButton]="true" [width]="420" (onHiding)="closeAdd()">
  <div class="popup-form">
    <div class="form-item">
      <label>Parent</label>
      <dx-select-box
        [dataSource]="parentOptions"
        displayExpr="label"
        valueExpr="id"
        [(value)]="form.parentId"
        placeholder="— Select parent —">
      </dx-select-box>
    </div>
    <div class="form-item">
      <label>Full name</label>
      <dx-text-box [(value)]="form.fullName"></dx-text-box>
    </div>
    <div class="form-item">
      <label>Grade</label>
      <dx-select-box
        [dataSource]="gradeOptions"
        displayExpr="label"
        valueExpr="value"
        [(value)]="form.grade">
      </dx-select-box>
    </div>
    <div class="form-item">
      <label>Date of birth</label>
      <dx-date-box [value]="form.dateOfBirth" (valueChange)="form.dateOfBirth = $event" type="date" placeholder=""></dx-date-box>
    </div>
    <div class="popup-actions">
      <dx-button text="Add" type="default" (onClick)="submitAdd()"></dx-button>
      <dx-button text="Cancel" type="normal" (onClick)="closeAdd()"></dx-button>
    </div>
  </div>
</dx-popup>
