# EduConnect API
#
# Database when starting the app:
#   - No profile (default) = H2 in-memory (no install; run without SQL Server)
#   - Profile "dev"        = H2 in-memory with console (create-drop)
#   - Profile "localdb"   = SQL Server LocalDB (--spring.profiles.active=localdb)
#   - For SQL Server on localhost:1433 set SPRING_DATASOURCE_URL and use a profile that uses it, or add profile "sqlserver"
#
server:
  port: 9095

spring:
  application:
    name: educonnect-api
  datasource:
    url: ${SPRING_DATASOURCE_URL:jdbc:h2:mem:educonnect;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE}
    driver-class-name: ${SPRING_DATASOURCE_DRIVER:org.h2.Driver}
    username: ${SPRING_DATASOURCE_USERNAME:sa}
    password: ${SPRING_DATASOURCE_PASSWORD:}
  jpa:
    hibernate:
      ddl-auto: ${JPA_DDL_AUTO:update}
    show-sql: false
    properties:
      hibernate:
        format_sql: true
        dialect: org.hibernate.dialect.H2Dialect
    open-in-view: false
  h2:
    console:
      enabled: ${H2_CONSOLE_ENABLED:false}

# App settings (override via env if needed)
app:
  datasource:
    auto-create-database: ${APP_AUTO_CREATE_DATABASE:true}
  timezone: ${APP_TIMEZONE:Asia/Yangon}   # Myanmar (UTC+6:30); "today" and reports use this
  security:
    roles:
      admin: ${APP_SECURITY_ROLE_ADMIN:ADMIN}
      teacher: ${APP_SECURITY_ROLE_TEACHER:TEACHER}
      parent: ${APP_SECURITY_ROLE_PARENT:PARENT}
    auth:
      login-path: ${APP_AUTH_LOGIN_PATH:/auth/login}
      refresh-path: ${APP_AUTH_REFRESH_PATH:/auth/refresh}
  subscription-expiring-alert-days: ${APP_SUBSCRIPTION_EXPIRING_ALERT_DAYS:7}
  contract-expiring-alert-days: ${APP_CONTRACT_EXPIRING_ALERT_DAYS:14}
  contract-ending-soon-notification-days: ${APP_CONTRACT_ENDING_SOON_DAYS:14}
  default-hourly-rate-for-revenue: ${APP_DEFAULT_HOURLY_RATE:0}
  group-session-min-hours-per-student: ${APP_GROUP_SESSION_MIN_HOURS:0.25}
  password-generation-length: ${APP_PASSWORD_GENERATION_LENGTH:12}
  # Parent student overview
  parent-overview-recent-months: ${APP_PARENT_OVERVIEW_RECENT_MONTHS:3}
  parent-overview-recent-sessions-max: ${APP_PARENT_OVERVIEW_RECENT_SESSIONS_MAX:20}
  parent-overview-total-sessions-years: ${APP_PARENT_OVERVIEW_TOTAL_SESSIONS_YEARS:1}
  # Admin reports default range when from/to not provided
  report-default-months-back: ${APP_REPORT_DEFAULT_MONTHS_BACK:11}
  # Public API URL (for frontend runtime config; CORS and links)
  api-public-url: ${API_PUBLIC_URL:http://localhost:9095}

# SeedData â€“ Default admin and roles (override via env: SEED_DATA_ADMIN_EMAIL, SEED_DATA_ADMIN_PASSWORD, SEED_DATA_ADMIN_FULL_NAME)
seed-data:
  admin:
    email: ${SEED_DATA_ADMIN_EMAIL:admin@educonnect.com}
    password: ${SEED_DATA_ADMIN_PASSWORD:1qaz!QAZ}
    full-name: ${SEED_DATA_ADMIN_FULL_NAME:EduConnect Admin}
  roles:
    - ADMIN
    - TEACHER
    - PARENT

# JWT (override via env: JWT_SECRET, JWT_EXPIRATION_MS, JWT_REFRESH_EXPIRATION_MS; set JWT_SECRET in production)
jwt:
  secret: ${JWT_SECRET:EduConnectSecretKeyForJWTTokenGenerationChangeInProduction}
  expiration-ms: ${JWT_EXPIRATION_MS:86400000}   # 24 hours
  refresh-expiration-ms: ${JWT_REFRESH_EXPIRATION_MS:604800000}   # 7 days

# CORS (allowed origins for Angular app)
cors:
  allowed-origins: ${CORS_ALLOWED_ORIGINS:http://localhost:9094}
  allowed-methods: GET,POST,PUT,PATCH,DELETE,OPTIONS
  allowed-headers: "*"
  allow-credentials: true

# Optional: rate limiting (requests per minute per IP)
rate-limiting:
  enabled: false
  requests-per-minute: 60
  login-rate-limit-enabled: true
  login-max-attempts-per-minute: 10
  login-window-ms: ${RATE_LIMIT_LOGIN_WINDOW_MS:60000}
  login-path: ${RATE_LIMIT_LOGIN_PATH:/auth/login}
  # rate-limit-exceeded-json default is in RateLimitProperties; override via env RATE_LIMIT_EXCEEDED_JSON if needed

# Health checks (liveness/readiness for k8s or load balancers)
management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      show-details: when-authorized
  health:
    livenessstate:
      enabled: true
    readinessstate:
      enabled: true
